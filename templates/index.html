<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Painel Leads Lite</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">PL</div>
      <div>
        <div class="title">Painel Leads Lite</div>
        <div class="subtitle">Leve • Intuitivo • BigQuery First</div>
      </div>
    </div>

    <!-- ✅ REMOVIDO: botão recarregar do topo -->
    <div class="actions"></div>
  </header>

  <main class="container">

    <!-- KPIs -->
    <section class="kpis">
      <div class="kpi">
        <div class="kpi-label">Total de leads</div>
        <div class="kpi-value" id="kpiCount">—</div>
      </div>
      <div class="kpi">
        <div class="kpi-label">Status predominante</div>
        <div class="kpi-value" id="kpiTopStatus">—</div>
      </div>
      <div class="kpi">
        <div class="kpi-label">Última inscrição</div>
        <div class="kpi-value" id="kpiLastDate">—</div>
      </div>
    </section>

    <!-- Upload -->
    <section class="card">
      <div class="card-header">
        <h2>Importar planilha</h2>
        <p>Envie CSV ou XLSX. O arquivo será carregado no BigQuery (staging).</p>
      </div>

      <div class="filters" style="grid-template-columns: repeat(6, minmax(0,1fr));">
        <div class="field" style="grid-column: span 4;">
          <label>Arquivo (CSV/XLSX)</label>
          <input id="uploadFile" type="file" accept=".csv,.xlsx,.xls" />
        </div>

        <div class="field" style="grid-column: span 2;">
          <label>Origem do upload (opcional)</label>
          <input id="uploadSource" placeholder="Ex: CAPTACAO_JANEIRO" />
        </div>

        <div class="field field-actions" style="grid-column: span 6;">
          <button id="btnUpload" class="btn btn-primary">Importar</button>
          <a class="btn btn-ghost" id="btnDownloadModel" href="/download/modelo" target="_blank" rel="noopener">
            Baixar modelo
          </a>
          <span id="uploadStatus" class="muted"></span>
        </div>
      </div>
    </section>

    <!-- Filtros -->
    <section class="card">
      <div class="card-header">
        <h2>Filtros</h2>
        <p>Refine os dados diretamente no BigQuery.</p>
      </div>

      <div class="filters">
        <div class="field">
          <label>Status</label>
          <input id="fStatus" list="dlStatus" placeholder="Ex: NOVO" />
          <datalist id="dlStatus"></datalist>
        </div>

        <!-- ✅ CURSO MULTI -->
        <div class="field">
          <label>Curso (multi)</label>

          <!-- chips -->
          <div class="chipbox" id="cursoChipBox" aria-label="Cursos selecionados"></div>

          <!-- input para adicionar rápido -->
          <div class="chiprow">
            <input id="fCurso" list="dlCurso" placeholder="Digite e pressione Enter para adicionar" />
            <button id="btnPickCursos" class="btn btn-ghost btn-sm" type="button">Ver todos</button>
          </div>

          <datalist id="dlCurso"></datalist>

          <!-- hidden: JS mantém lista -->
          <input type="hidden" id="fCursoMulti" value="" />
        </div>

        <!-- ✅ POLO MULTI -->
        <div class="field">
          <label>Polo (multi)</label>

          <div class="chipbox" id="poloChipBox" aria-label="Polos selecionados"></div>

          <div class="chiprow">
            <input id="fPolo" list="dlPolo" placeholder="Digite e pressione Enter para adicionar" />
            <button id="btnPickPolos" class="btn btn-ghost btn-sm" type="button">Ver todos</button>
          </div>

          <datalist id="dlPolo"></datalist>

          <input type="hidden" id="fPoloMulti" value="" />
        </div>

        <div class="field">
          <label>Origem</label>
          <input id="fOrigem" list="dlOrigem" placeholder="Ex: Meta Ads" />
          <datalist id="dlOrigem"></datalist>
        </div>

        <div class="field">
          <label>Data inicial</label>
          <input id="fIni" type="date" />
        </div>

        <div class="field">
          <label>Data final</label>
          <input id="fFim" type="date" />
        </div>

        <div class="field field-wide">
          <label>Limite</label>
          <input id="fLimit" type="number" min="50" step="50" value="500" />
        </div>

        <!-- ✅ AÇÕES: recarregar junto do export -->
        <div class="field field-actions">
          <button id="btnApply" class="btn btn-primary">Aplicar filtros</button>
          <button id="btnClear" class="btn btn-ghost">Limpar</button>

          <button id="btnReload" class="btn btn-ghost" type="button">Recarregar</button>
          <button id="btnExportFilters" class="btn btn-ghost" type="button">Exportar CSV</button>
        </div>
      </div>
    </section>

    <!-- Resultados -->
    <section class="card">
      <div class="card-header">
        <h2>Resultados</h2>
        <p id="statusLine">—</p>
      </div>

      <div class="table-wrap">
        <table id="tbl">
          <thead>
            <tr>
              <th>Data</th>
              <th>Nome</th>
              <th>CPF</th>
              <th>Celular</th>
              <th>Email</th>
              <th>Origem</th>
              <th>Polo</th>
              <th>Curso</th>
              <th>Status</th>
              <th>Consultor</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <footer class="footer">
      <span>© Painel Leads Lite</span>
      <span class="muted">Dados do BigQuery • Upload em staging</span>
    </footer>

  </main>

  <!-- =======================================================
       MODAL: CURSOS
  ======================================================== -->
  <div id="modalCursos" class="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalCursosTitle">
      <div class="modal-head">
        <div>
          <div class="modal-title" id="modalCursosTitle">Selecionar cursos</div>
          <div class="muted">Marque vários e clique em “Aplicar”.</div>
        </div>
        <button class="btn btn-ghost btn-sm" id="btnCloseCursos" type="button">Fechar</button>
      </div>

      <div class="modal-body">
        <div class="modal-tools">
          <input id="modalCursosSearch" placeholder="Buscar curso..." />
          <button id="btnCursosClear" class="btn btn-ghost btn-sm" type="button">Limpar seleção</button>
        </div>

        <div id="modalCursosList" class="modal-list"></div>
      </div>

      <div class="modal-foot">
        <button id="btnCursosApply" class="btn btn-primary" type="button">Aplicar</button>
      </div>
    </div>
  </div>

  <!-- =======================================================
       MODAL: POLOS
  ======================================================== -->
  <div id="modalPolos" class="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalPolosTitle">
      <div class="modal-head">
        <div>
          <div class="modal-title" id="modalPolosTitle">Selecionar polos</div>
          <div class="muted">Marque vários e clique em “Aplicar”.</div>
        </div>
        <button class="btn btn-ghost btn-sm" id="btnClosePolos" type="button">Fechar</button>
      </div>

      <div class="modal-body">
        <div class="modal-tools">
          <input id="modalPolosSearch" placeholder="Buscar polo..." />
          <button id="btnPolosClear" class="btn btn-ghost btn-sm" type="button">Limpar seleção</button>
        </div>

        <div id="modalPolosList" class="modal-list"></div>
      </div>

      <div class="modal-foot">
        <button id="btnPolosApply" class="btn btn-primary" type="button">Aplicar</button>
      </div>
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
